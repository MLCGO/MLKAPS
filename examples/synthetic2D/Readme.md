# Synthetic 2D Example

This minimal examples shows how to run MLKAPS, and how to plug-in a python kernel.

Content:
- `ga_adaptive.json` contains an example configuration to run MLKAPS with the GA-Adaptive sampler.
    Note how the kernel is defined:
    ```json
        "runner": "function",
        "runner_parameters": {
            "function": "main.py:main",
            "timeout": 5
        }
    ```
    This will allow MLKAPS to import the target module and directly call the kernel without having to instantiate a subprocess.
    This feature is useful to:
    - Reduce the sampling overhead since we don't have to create a new process.
    - Allow user code to be run during the module initialization. For example, you could pre-generate your kernel data once, and reuse it across multiple calls to reduce sampling cost.

- `main.py` contains the synthetic kernel.

## Prerequisites

We expect you to already have MLKAPS installed. Otherwise, follow the installation guidelines provided in the main [README](../../README.md).

## Running the Test

To run the test, simply execute the following command:

```sh
mlkaps ga_adaptive.json
```

This command will use the `ga-adaptive.json` configuration file to perform the test.

## Outputs

The `mlkaps_output` folder contains the different output generated by MLKAPS:
- `kernel_sampling/samples.csv` contains the samples collected by MLKAPS.
- `metadata` contains the log and a copy of the configuration file used for this experiment (i.e. `ga_adaptive.json`)
- `optim.csv` contains the optimization results of MLKAPS on a regular grid.
- `c_clustered_model.pkl` and `b_clustered_model.pkl` contains the [pickled](https://docs.python.org/3/library/pickle.html) decision trees for both design parameters, fitted on `optim.csv` ([Scikit-Learn decision tree regressor](https://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeRegressor.html)).
- `C_b_tree.c` and `C_c_tree.c` contain the decision trees converted to C code.
- `r_model.pkl` contains the [pickled](https://docs.python.org/3/library/pickle.html) surrogate model trained by MLKAPS.

**Note: pickled objects may not be compatible between python versions, and can easily break when updating the virtualenv. It is common to refit the different models using the raw csv data.**
